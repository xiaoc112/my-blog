# æ¨¡å—å¼€å‘æŒ‡å—

åŸºäº nest-admin é¡¹ç›®çš„æ–°åŠŸèƒ½æ¨¡å—å¼€å‘å®è·µ

## ğŸ“š ç›®å½•

- [æ¨¡å—å¼€å‘æŒ‡å—](#æ¨¡å—å¼€å‘æŒ‡å—)
  - [ğŸ“š ç›®å½•](#-ç›®å½•)
  - [ğŸ’¡ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ—ï¸ æ¨¡å—æ¶æ„è®¾è®¡](#ï¸-æ¨¡å—æ¶æ„è®¾è®¡)
    - [1. é¡¹ç›®æ¨¡å—ç»„ç»‡ç»“æ„](#1-é¡¹ç›®æ¨¡å—ç»„ç»‡ç»“æ„)
    - [2. æ ‡å‡†æ¨¡å—ç»“æ„](#2-æ ‡å‡†æ¨¡å—ç»“æ„)
    - [3. æ¨¡å—é—´ä¾èµ–å…³ç³»](#3-æ¨¡å—é—´ä¾èµ–å…³ç³»)
  - [ğŸ“ åˆ›å»ºæ–°æ¨¡å—çš„æ­¥éª¤](#-åˆ›å»ºæ–°æ¨¡å—çš„æ­¥éª¤)
    - [Step 1: åˆ›å»ºæ¨¡å—ç›®å½•ç»“æ„](#step-1-åˆ›å»ºæ¨¡å—ç›®å½•ç»“æ„)
    - [Step 2: åˆ›å»ºå®ä½“ç±» (Entity)](#step-2-åˆ›å»ºå®ä½“ç±»-entity)
    - [Step 3: åˆ›å»ºæ•°æ®ä¼ è¾“å¯¹è±¡ (DTO)](#step-3-åˆ›å»ºæ•°æ®ä¼ è¾“å¯¹è±¡-dto)
    - [Step 4: åˆ›å»ºæœåŠ¡ç±» (Service)](#step-4-åˆ›å»ºæœåŠ¡ç±»-service)
    - [Step 5: åˆ›å»ºæ§åˆ¶å™¨ (Controller)](#step-5-åˆ›å»ºæ§åˆ¶å™¨-controller)
    - [Step 6: åˆ›å»ºæ¨¡å—æ–‡ä»¶ (Module)](#step-6-åˆ›å»ºæ¨¡å—æ–‡ä»¶-module)
    - [Step 7: æ³¨å†Œåˆ°çˆ¶æ¨¡å—](#step-7-æ³¨å†Œåˆ°çˆ¶æ¨¡å—)
  - [ğŸ”§ é«˜çº§å¼€å‘æŠ€å·§](#-é«˜çº§å¼€å‘æŠ€å·§)
    - [1. å®ä½“å…³ç³»æ˜ å°„](#1-å®ä½“å…³ç³»æ˜ å°„)
      - [ä¸€å¯¹ä¸€å…³ç³» (OneToOne)](#ä¸€å¯¹ä¸€å…³ç³»-onetoone)
      - [ä¸€å¯¹å¤šå…³ç³» (OneToMany)](#ä¸€å¯¹å¤šå…³ç³»-onetomany)
      - [å¤šå¯¹å¤šå…³ç³» (ManyToMany)](#å¤šå¯¹å¤šå…³ç³»-manytomany)
    - [2. æ•°æ®éªŒè¯ä¸è½¬æ¢](#2-æ•°æ®éªŒè¯ä¸è½¬æ¢)
    - [3. æƒé™æ§åˆ¶é›†æˆ](#3-æƒé™æ§åˆ¶é›†æˆ)
    - [4. ç¼“å­˜é›†æˆ](#4-ç¼“å­˜é›†æˆ)
    - [5. äº‹ä»¶å¤„ç†](#5-äº‹ä»¶å¤„ç†)
  - [ğŸ“‹ å®æˆ˜æ¡ˆä¾‹ï¼šå¼€å‘æ–‡ç« æ¨¡å—](#-å®æˆ˜æ¡ˆä¾‹å¼€å‘æ–‡ç« æ¨¡å—)
    - [1. åˆ›å»ºæ–‡ç« å®ä½“](#1-åˆ›å»ºæ–‡ç« å®ä½“)
    - [2. åˆ›å»ºæ–‡ç«  DTO](#2-åˆ›å»ºæ–‡ç« -dto)
    - [3. åˆ›å»ºæ–‡ç« æœåŠ¡](#3-åˆ›å»ºæ–‡ç« æœåŠ¡)
    - [4. åˆ›å»ºæ–‡ç« æ§åˆ¶å™¨](#4-åˆ›å»ºæ–‡ç« æ§åˆ¶å™¨)
    - [5. åˆ›å»ºæ–‡ç« æ¨¡å—](#5-åˆ›å»ºæ–‡ç« æ¨¡å—)
  - [âš¡ æœ€ä½³å®è·µä¸è§„èŒƒ](#-æœ€ä½³å®è·µä¸è§„èŒƒ)
    - [1. å‘½åè§„èŒƒ](#1-å‘½åè§„èŒƒ)
    - [2. ä»£ç ç»„ç»‡](#2-ä»£ç ç»„ç»‡)
    - [3. é”™è¯¯å¤„ç†](#3-é”™è¯¯å¤„ç†)
    - [4. æ€§èƒ½ä¼˜åŒ–](#4-æ€§èƒ½ä¼˜åŒ–)
    - [5. æµ‹è¯•ç¼–å†™](#5-æµ‹è¯•ç¼–å†™)

## ğŸ’¡ æ¦‚è¿°

åœ¨ `nest-admin` é¡¹ç›®ä¸­ï¼Œæ¨¡å—æ˜¯ç»„ç»‡ä¸šåŠ¡é€»è¾‘çš„åŸºæœ¬å•ä½ã€‚é¡¹ç›®é‡‡ç”¨äº†æ¸…æ™°çš„æ¨¡å—åŒ–æ¶æ„ï¼Œæ¯ä¸ªæ¨¡å—è´Ÿè´£ç‰¹å®šçš„ä¸šåŠ¡é¢†åŸŸã€‚æœ¬æŒ‡å—å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ç°æœ‰æ¶æ„åŸºç¡€ä¸Šå¼€å‘æ–°çš„åŠŸèƒ½æ¨¡å—ï¼Œéµå¾ªé¡¹ç›®çš„è®¾è®¡æ¨¡å¼å’Œæœ€ä½³å®è·µã€‚

## ğŸ—ï¸ æ¨¡å—æ¶æ„è®¾è®¡

### 1. é¡¹ç›®æ¨¡å—ç»„ç»‡ç»“æ„

```
src/modules/
â”œâ”€â”€ auth/           # è®¤è¯æˆæƒæ¨¡å—
â”œâ”€â”€ user/           # ç”¨æˆ·ç®¡ç†æ¨¡å—
â”œâ”€â”€ system/         # ç³»ç»Ÿç®¡ç†æ¨¡å—é›†åˆ
â”‚   â”œâ”€â”€ role/       # è§’è‰²ç®¡ç†
â”‚   â”œâ”€â”€ menu/       # èœå•ç®¡ç†
â”‚   â”œâ”€â”€ dept/       # éƒ¨é—¨ç®¡ç†
â”‚   â”œâ”€â”€ dict-type/  # å­—å…¸ç±»å‹
â”‚   â”œâ”€â”€ dict-item/  # å­—å…¸é¡¹
â”‚   â”œâ”€â”€ log/        # æ—¥å¿—ç®¡ç†
â”‚   â”œâ”€â”€ task/       # ä»»åŠ¡è°ƒåº¦
â”‚   â””â”€â”€ ...
â”œâ”€â”€ tools/          # å·¥å…·æ¨¡å—é›†åˆ
â”‚   â”œâ”€â”€ storage/    # æ–‡ä»¶å­˜å‚¨
â”‚   â”œâ”€â”€ upload/     # æ–‡ä»¶ä¸Šä¼ 
â”‚   â””â”€â”€ ...
â”œâ”€â”€ todo/           # å¾…åŠäº‹é¡¹æ¨¡å—
â”œâ”€â”€ tasks/          # åå°ä»»åŠ¡æ¨¡å—
â”œâ”€â”€ sse/            # æœåŠ¡ç«¯æ¨é€æ¨¡å—
â”œâ”€â”€ netdisk/        # ç½‘ç›˜ç®¡ç†æ¨¡å—
â””â”€â”€ health/         # å¥åº·æ£€æŸ¥æ¨¡å—
```

### 2. æ ‡å‡†æ¨¡å—ç»“æ„

æ¯ä¸ªåŠŸèƒ½æ¨¡å—éƒ½åº”éµå¾ªä»¥ä¸‹æ ‡å‡†ç»“æ„ï¼š

```
module-name/
â”œâ”€â”€ dto/                    # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”œâ”€â”€ create-xxx.dto.ts  # åˆ›å»ºæ•°æ®çš„DTO
â”‚   â”œâ”€â”€ update-xxx.dto.ts  # æ›´æ–°æ•°æ®çš„DTO
â”‚   â””â”€â”€ query-xxx.dto.ts   # æŸ¥è¯¢å‚æ•°çš„DTO
â”œâ”€â”€ entities/              # å®ä½“æ–‡ä»¶ (å¯é€‰ï¼Œå¤æ‚æ¨¡å—ä½¿ç”¨)
â”‚   â””â”€â”€ xxx.entity.ts
â”œâ”€â”€ xxx.entity.ts          # ä¸»å®ä½“æ–‡ä»¶
â”œâ”€â”€ xxx.service.ts         # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”œâ”€â”€ xxx.controller.ts      # æ§åˆ¶å™¨
â”œâ”€â”€ xxx.module.ts          # æ¨¡å—å®šä¹‰
â”œâ”€â”€ xxx.model.ts           # æ•°æ®æ¨¡å‹ (å¯é€‰)
â””â”€â”€ constant.ts            # æ¨¡å—å¸¸é‡ (å¯é€‰)
```

### 3. æ¨¡å—é—´ä¾èµ–å…³ç³»

- **åŸºç¡€æ¨¡å—**ï¼š`common`ã€`shared`ã€`config` - è¢«æ‰€æœ‰æ¨¡å—ä¾èµ–
- **æ ¸å¿ƒæ¨¡å—**ï¼š`auth`ã€`user` - æä¾›åŸºç¡€è®¤è¯å’Œç”¨æˆ·åŠŸèƒ½
- **ç³»ç»Ÿæ¨¡å—**ï¼š`system` - æä¾›ç³»ç»Ÿç®¡ç†åŠŸèƒ½
- **ä¸šåŠ¡æ¨¡å—**ï¼š`todo`ã€`netdisk` ç­‰ - å®ç°å…·ä½“ä¸šåŠ¡åŠŸèƒ½
- **å·¥å…·æ¨¡å—**ï¼š`tools` - æä¾›é€šç”¨å·¥å…·åŠŸèƒ½

## ğŸ“ åˆ›å»ºæ–°æ¨¡å—çš„æ­¥éª¤

ä»¥åˆ›å»ºä¸€ä¸ª"æ–‡ç« ç®¡ç†"æ¨¡å—ä¸ºä¾‹ï¼Œè¯¦ç»†è¯´æ˜å¼€å‘æ­¥éª¤ï¼š

### Step 1: åˆ›å»ºæ¨¡å—ç›®å½•ç»“æ„

```bash
mkdir -p src/modules/article/dto
touch src/modules/article/article.entity.ts
touch src/modules/article/article.service.ts
touch src/modules/article/article.controller.ts
touch src/modules/article/article.module.ts
touch src/modules/article/dto/create-article.dto.ts
touch src/modules/article/dto/update-article.dto.ts
touch src/modules/article/dto/query-article.dto.ts
```

### Step 2: åˆ›å»ºå®ä½“ç±» (Entity)

```typescript
import { ApiProperty } from '@nestjs/swagger'
// src/modules/article/article.entity.ts
import { Column, Entity, JoinColumn, ManyToOne, Relation } from 'typeorm'

import { CompleteEntity } from '~/common/entity/common.entity'
import { UserEntity } from '~/modules/user/user.entity'

@Entity({ name: 'app_article' })
export class ArticleEntity extends CompleteEntity {
  @Column({ length: 100 })
  @ApiProperty({ description: 'æ–‡ç« æ ‡é¢˜' })
  title: string

  @Column({ type: 'text' })
  @ApiProperty({ description: 'æ–‡ç« å†…å®¹' })
  content: string

  @Column({ length: 200, nullable: true })
  @ApiProperty({ description: 'æ–‡ç« æ‘˜è¦' })
  summary: string

  @Column({ name: 'cover_image', nullable: true })
  @ApiProperty({ description: 'å°é¢å›¾ç‰‡' })
  coverImage: string

  @Column({ type: 'int', default: 0 })
  @ApiProperty({ description: 'é˜…è¯»æ¬¡æ•°' })
  viewCount: number

  @Column({ type: 'tinyint', default: 1 })
  @ApiProperty({ description: 'çŠ¶æ€ï¼š1å‘å¸ƒï¼Œ0è‰ç¨¿' })
  status: number

  @Column({ name: 'publish_time', nullable: true })
  @ApiProperty({ description: 'å‘å¸ƒæ—¶é—´' })
  publishTime: Date

  @Column({ name: 'author_id' })
  @ApiProperty({ description: 'ä½œè€…ID' })
  authorId: number

  // å…³è”ä½œè€…
  @ManyToOne(() => UserEntity)
  @JoinColumn({ name: 'author_id' })
  author: Relation<UserEntity>
}
```

### Step 3: åˆ›å»ºæ•°æ®ä¼ è¾“å¯¹è±¡ (DTO)

```typescript
// src/modules/article/dto/create-article.dto.ts
import { ApiProperty } from '@nestjs/swagger'
import { IsNotEmpty, IsOptional, IsString, MaxLength } from 'class-validator'

export class CreateArticleDto {
  @ApiProperty({ description: 'æ–‡ç« æ ‡é¢˜' })
  @IsNotEmpty({ message: 'æ–‡ç« æ ‡é¢˜ä¸èƒ½ä¸ºç©º' })
  @IsString({ message: 'æ–‡ç« æ ‡é¢˜å¿…é¡»æ˜¯å­—ç¬¦ä¸²' })
  @MaxLength(100, { message: 'æ–‡ç« æ ‡é¢˜é•¿åº¦ä¸èƒ½è¶…è¿‡100ä¸ªå­—ç¬¦' })
  title: string

  @ApiProperty({ description: 'æ–‡ç« å†…å®¹' })
  @IsNotEmpty({ message: 'æ–‡ç« å†…å®¹ä¸èƒ½ä¸ºç©º' })
  @IsString({ message: 'æ–‡ç« å†…å®¹å¿…é¡»æ˜¯å­—ç¬¦ä¸²' })
  content: string

  @ApiProperty({ description: 'æ–‡ç« æ‘˜è¦', required: false })
  @IsOptional()
  @IsString({ message: 'æ–‡ç« æ‘˜è¦å¿…é¡»æ˜¯å­—ç¬¦ä¸²' })
  @MaxLength(200, { message: 'æ–‡ç« æ‘˜è¦é•¿åº¦ä¸èƒ½è¶…è¿‡200ä¸ªå­—ç¬¦' })
  summary?: string

  @ApiProperty({ description: 'å°é¢å›¾ç‰‡', required: false })
  @IsOptional()
  @IsString({ message: 'å°é¢å›¾ç‰‡å¿…é¡»æ˜¯å­—ç¬¦ä¸²' })
  coverImage?: string

  @ApiProperty({ description: 'çŠ¶æ€ï¼š1å‘å¸ƒï¼Œ0è‰ç¨¿', required: false })
  @IsOptional()
  status?: number
}
```

```typescript
// src/modules/article/dto/update-article.dto.ts
import { ApiProperty, PartialType } from '@nestjs/swagger'
import { IsNumber, IsOptional } from 'class-validator'
import { CreateArticleDto } from './create-article.dto'

export class UpdateArticleDto extends PartialType(CreateArticleDto) {
  @ApiProperty({ description: 'æ–‡ç« ID' })
  @IsNumber({}, { message: 'æ–‡ç« IDå¿…é¡»æ˜¯æ•°å­—' })
  id: number
}
```

```typescript
// src/modules/article/dto/query-article.dto.ts
import { ApiProperty } from '@nestjs/swagger'
import { IsNumber, IsOptional, IsString } from 'class-validator'
import { PaginationDto } from '~/common/dto/pagination.dto'

export class QueryArticleDto extends PaginationDto {
  @ApiProperty({ description: 'æ–‡ç« æ ‡é¢˜', required: false })
  @IsOptional()
  @IsString()
  title?: string

  @ApiProperty({ description: 'ä½œè€…ID', required: false })
  @IsOptional()
  @IsNumber()
  authorId?: number

  @ApiProperty({ description: 'çŠ¶æ€', required: false })
  @IsOptional()
  @IsNumber()
  status?: number
}
```

### Step 4: åˆ›å»ºæœåŠ¡ç±» (Service)

```typescript
// src/modules/article/article.service.ts
import { Injectable, NotFoundException } from '@nestjs/common'
import { InjectRepository } from '@nestjs/typeorm'
import { Like, Repository } from 'typeorm'
import { paginate, Pagination } from '~/helper/paginate'
import { ArticleEntity } from './article.entity'
import { CreateArticleDto } from './dto/create-article.dto'
import { QueryArticleDto } from './dto/query-article.dto'
import { UpdateArticleDto } from './dto/update-article.dto'

@Injectable()
export class ArticleService {
  constructor(
    @InjectRepository(ArticleEntity)
    private articleRepository: Repository<ArticleEntity>,
  ) {}

  /**
   * åˆ›å»ºæ–‡ç« 
   */
  async create(createArticleDto: CreateArticleDto, authorId: number): Promise<ArticleEntity> {
    const article = this.articleRepository.create({
      ...createArticleDto,
      authorId,
      publishTime: createArticleDto.status === 1 ? new Date() : null,
    })

    return await this.articleRepository.save(article)
  }

  /**
   * åˆ†é¡µæŸ¥è¯¢æ–‡ç« åˆ—è¡¨
   */
  async findAll(queryDto: QueryArticleDto): Promise<Pagination<ArticleEntity>> {
    const { page, pageSize, title, authorId, status } = queryDto

    const queryBuilder = this.articleRepository
      .createQueryBuilder('article')
      .leftJoinAndSelect('article.author', 'author')
      .select([
        'article',
        'author.id',
        'author.username',
        'author.nickname',
      ])

    if (title) {
      queryBuilder.andWhere('article.title LIKE :title', { title: `%${title}%` })
    }

    if (authorId) {
      queryBuilder.andWhere('article.authorId = :authorId', { authorId })
    }

    if (status !== undefined) {
      queryBuilder.andWhere('article.status = :status', { status })
    }

    queryBuilder.orderBy('article.createdAt', 'DESC')

    return paginate(queryBuilder, { page, pageSize })
  }

  /**
   * æ ¹æ®IDæŸ¥è¯¢æ–‡ç« è¯¦æƒ…
   */
  async findOne(id: number): Promise<ArticleEntity> {
    const article = await this.articleRepository.findOne({
      where: { id },
      relations: ['author'],
    })

    if (!article) {
      throw new NotFoundException(`IDä¸º ${id} çš„æ–‡ç« ä¸å­˜åœ¨`)
    }

    // å¢åŠ é˜…è¯»æ¬¡æ•°
    await this.articleRepository.update(id, {
      viewCount: () => 'view_count + 1'
    })

    return article
  }

  /**
   * æ›´æ–°æ–‡ç« 
   */
  async update(id: number, updateArticleDto: UpdateArticleDto): Promise<ArticleEntity> {
    const article = await this.findOne(id)

    // å¦‚æœçŠ¶æ€ä»è‰ç¨¿å˜ä¸ºå‘å¸ƒï¼Œè®¾ç½®å‘å¸ƒæ—¶é—´
    if (article.status === 0 && updateArticleDto.status === 1) {
      updateArticleDto.publishTime = new Date()
    }

    await this.articleRepository.update(id, updateArticleDto)
    return this.findOne(id)
  }

  /**
   * åˆ é™¤æ–‡ç« 
   */
  async remove(id: number): Promise<void> {
    const article = await this.findOne(id)
    await this.articleRepository.remove(article)
  }

  /**
   * æ‰¹é‡åˆ é™¤æ–‡ç« 
   */
  async removeMany(ids: number[]): Promise<void> {
    await this.articleRepository.delete(ids)
  }
}
```

### Step 5: åˆ›å»ºæ§åˆ¶å™¨ (Controller)

```typescript
// src/modules/article/article.controller.ts
import {
  Body,
  Controller,
  Delete,
  Get,
  Param,
  ParseIntPipe,
  Patch,
  Post,
  Query,
} from '@nestjs/common'
import { ApiOperation, ApiParam, ApiTags } from '@nestjs/swagger'

import { RequirePermissions } from '~/common/decorators/permissions.decorator'
import { ApiSecurityAuth } from '~/common/decorators/swagger.decorator'
import { CurrentUser } from '~/modules/auth/decorators/current-user.decorator'
import { UserEntity } from '~/modules/user/user.entity'

import { ArticleService } from './article.service'
import { CreateArticleDto } from './dto/create-article.dto'
import { QueryArticleDto } from './dto/query-article.dto'
import { UpdateArticleDto } from './dto/update-article.dto'

@ApiTags('æ–‡ç« ç®¡ç†')
@ApiSecurityAuth()
@Controller('article')
export class ArticleController {
  constructor(private readonly articleService: ArticleService) {}

  @Post()
  @ApiOperation({ summary: 'åˆ›å»ºæ–‡ç« ' })
  @RequirePermissions('article:create')
  async create(
    @Body() createArticleDto: CreateArticleDto,
    @CurrentUser() user: UserEntity,
  ) {
    return this.articleService.create(createArticleDto, user.id)
  }

  @Get()
  @ApiOperation({ summary: 'è·å–æ–‡ç« åˆ—è¡¨' })
  @RequirePermissions('article:read')
  async findAll(@Query() queryDto: QueryArticleDto) {
    return this.articleService.findAll(queryDto)
  }

  @Get(':id')
  @ApiOperation({ summary: 'è·å–æ–‡ç« è¯¦æƒ…' })
  @ApiParam({ name: 'id', description: 'æ–‡ç« ID' })
  @RequirePermissions('article:read')
  async findOne(@Param('id', ParseIntPipe) id: number) {
    return this.articleService.findOne(id)
  }

  @Patch(':id')
  @ApiOperation({ summary: 'æ›´æ–°æ–‡ç« ' })
  @ApiParam({ name: 'id', description: 'æ–‡ç« ID' })
  @RequirePermissions('article:update')
  async update(
    @Param('id', ParseIntPipe) id: number,
    @Body() updateArticleDto: UpdateArticleDto,
  ) {
    return this.articleService.update(id, updateArticleDto)
  }

  @Delete(':id')
  @ApiOperation({ summary: 'åˆ é™¤æ–‡ç« ' })
  @ApiParam({ name: 'id', description: 'æ–‡ç« ID' })
  @RequirePermissions('article:delete')
  async remove(@Param('id', ParseIntPipe) id: number) {
    return this.articleService.remove(id)
  }

  @Post('batch-delete')
  @ApiOperation({ summary: 'æ‰¹é‡åˆ é™¤æ–‡ç« ' })
  @RequirePermissions('article:delete')
  async removeMany(@Body('ids') ids: number[]) {
    return this.articleService.removeMany(ids)
  }
}
```

### Step 6: åˆ›å»ºæ¨¡å—æ–‡ä»¶ (Module)

```typescript
// src/modules/article/article.module.ts
import { Module } from '@nestjs/common'
import { TypeOrmModule } from '@nestjs/typeorm'

import { ArticleController } from './article.controller'
import { ArticleEntity } from './article.entity'
import { ArticleService } from './article.service'

const providers = [ArticleService]

@Module({
  imports: [
    TypeOrmModule.forFeature([ArticleEntity])
  ],
  controllers: [ArticleController],
  providers: [...providers],
  exports: [TypeOrmModule, ...providers],
})
export class ArticleModule {}
```

### Step 7: æ³¨å†Œåˆ°çˆ¶æ¨¡å—

å°†æ–°æ¨¡å—æ³¨å†Œåˆ°é€‚å½“çš„çˆ¶æ¨¡å—æˆ–ç›´æ¥æ³¨å†Œåˆ°ä¸»åº”ç”¨æ¨¡å—ï¼š

```typescript
// src/app.module.ts
import { ArticleModule } from './modules/article/article.module'

@Module({
  imports: [
    // ... å…¶ä»–æ¨¡å—
    ArticleModule,
  ],
  // ...
})
export class AppModule {}
```

## ğŸ”§ é«˜çº§å¼€å‘æŠ€å·§

### 1. å®ä½“å…³ç³»æ˜ å°„

#### ä¸€å¯¹ä¸€å…³ç³» (OneToOne)
```typescript
@OneToOne(() => ProfileEntity)
@JoinColumn()
profile: Relation<ProfileEntity>
```

#### ä¸€å¯¹å¤šå…³ç³» (OneToMany)
```typescript
@OneToMany(() => CommentEntity, comment => comment.article)
comments: Relation<CommentEntity[]>
```

#### å¤šå¯¹å¤šå…³ç³» (ManyToMany)
```typescript
@ManyToMany(() => TagEntity)
@JoinTable({
  name: 'article_tags',
  joinColumn: { name: 'article_id', referencedColumnName: 'id' },
  inverseJoinColumn: { name: 'tag_id', referencedColumnName: 'id' },
})
tags: Relation<TagEntity[]>
```

### 2. æ•°æ®éªŒè¯ä¸è½¬æ¢

ä½¿ç”¨ `class-validator` å’Œ `class-transformer` è¿›è¡Œæ•°æ®éªŒè¯ï¼š

```typescript
import { Transform } from 'class-transformer'
import { IsEmail, IsOptional, IsPhoneNumber } from 'class-validator'

export class CreateUserDto {
  @IsEmail({}, { message: 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®' })
  @Transform(({ value }) => value.toLowerCase()) // è½¬æ¢ä¸ºå°å†™
  email: string

  @IsOptional()
  @IsPhoneNumber('CN', { message: 'æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®' })
  phone?: string
}
```

### 3. æƒé™æ§åˆ¶é›†æˆ

ä¸ºæ–°æ¨¡å—æ·»åŠ æƒé™æ§åˆ¶ï¼š

```typescript
// åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸Šæ·»åŠ æƒé™è£…é¥°å™¨
@RequirePermissions('article:create', 'article:publish')
async createAndPublish() {
  // éœ€è¦åŒæ—¶æ‹¥æœ‰åˆ›å»ºå’Œå‘å¸ƒæƒé™
}

// ä½¿ç”¨è§’è‰²éªŒè¯
@RequireRoles('admin', 'editor')
async adminOnly() {
  // åªæœ‰ç®¡ç†å‘˜å’Œç¼–è¾‘å¯ä»¥è®¿é—®
}
```

### 4. ç¼“å­˜é›†æˆ

ä½¿ç”¨ Redis ç¼“å­˜æé«˜æ€§èƒ½ï¼š

```typescript
import { CACHE_MANAGER } from '@nestjs/cache-manager'
import { Cache } from 'cache-manager'

@Injectable()
export class ArticleService {
  constructor(
    @Inject(CACHE_MANAGER) private cacheManager: Cache,
  ) {}

  async findHotArticles(): Promise<ArticleEntity[]> {
    const cacheKey = 'hot-articles'

    // å°è¯•ä»ç¼“å­˜è·å–
    let articles = await this.cacheManager.get<ArticleEntity[]>(cacheKey)

    if (!articles) {
      // ä»æ•°æ®åº“æŸ¥è¯¢
      articles = await this.articleRepository.find({
        where: { status: 1 },
        order: { viewCount: 'DESC' },
        take: 10,
      })

      // ç¼“å­˜ç»“æœï¼Œè¿‡æœŸæ—¶é—´ 5 åˆ†é’Ÿ
      await this.cacheManager.set(cacheKey, articles, 5 * 60 * 1000)
    }

    return articles
  }
}
```

### 5. äº‹ä»¶å¤„ç†

ä½¿ç”¨äº‹ä»¶ç³»ç»Ÿå®ç°æ¨¡å—é—´è§£è€¦ï¼š

```typescript
// å®šä¹‰äº‹ä»¶
// åœ¨æœåŠ¡ä¸­å‘å‡ºäº‹ä»¶
import { EventEmitter2 } from '@nestjs/event-emitter'

export class ArticlePublishedEvent {
  constructor(
    public readonly articleId: number,
    public readonly authorId: number,
  ) {}
}

@Injectable()
export class ArticleService {
  constructor(
    private eventEmitter: EventEmitter2,
  ) {}

  async publishArticle(id: number): Promise<void> {
    // ... å‘å¸ƒé€»è¾‘

    // å‘å‡ºäº‹ä»¶
    this.eventEmitter.emit('article.published', new ArticlePublishedEvent(id, authorId))
  }
}

// åœ¨å…¶ä»–æœåŠ¡ä¸­ç›‘å¬äº‹ä»¶
@Injectable()
export class NotificationService {
  @OnEvent('article.published')
  async handleArticlePublished(event: ArticlePublishedEvent): Promise<void> {
    // å‘é€é€šçŸ¥é€»è¾‘
    console.log(`æ–‡ç«  ${event.articleId} å·²å‘å¸ƒï¼Œä½œè€…ï¼š${event.authorId}`)
  }
}
```

## ğŸ“‹ å®æˆ˜æ¡ˆä¾‹ï¼šå¼€å‘æ–‡ç« æ¨¡å—

ä¸Šè¿°æ­¥éª¤å±•ç¤ºäº†ä¸€ä¸ªå®Œæ•´çš„æ–‡ç« æ¨¡å—å¼€å‘è¿‡ç¨‹ã€‚ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ä¸€äº›å®é™…çš„å®ç°ç»†èŠ‚ï¼š

### 1. åˆ›å»ºæ–‡ç« å®ä½“

æ–‡ç« å®ä½“è®¾è®¡è¦è€ƒè™‘ï¼š
- åŸºç¡€å­—æ®µï¼šæ ‡é¢˜ã€å†…å®¹ã€æ‘˜è¦
- çŠ¶æ€ç®¡ç†ï¼šè‰ç¨¿ã€å‘å¸ƒã€ä¸‹çº¿
- å…³è”å…³ç³»ï¼šä½œè€…ã€åˆ†ç±»ã€æ ‡ç­¾
- ç»Ÿè®¡ä¿¡æ¯ï¼šé˜…è¯»æ¬¡æ•°ã€ç‚¹èµæ•°

### 2. åˆ›å»ºæ–‡ç«  DTO

DTO è®¾è®¡è¦è€ƒè™‘ï¼š
- è¾“å…¥éªŒè¯ï¼šå­—æ®µç±»å‹ã€é•¿åº¦ã€å¿…å¡«æ€§
- å®‰å…¨è¿‡æ»¤ï¼šé˜²æ­¢ XSSã€SQL æ³¨å…¥
- ä¸šåŠ¡è§„åˆ™ï¼šçŠ¶æ€è½¬æ¢ã€æƒé™æ£€æŸ¥

### 3. åˆ›å»ºæ–‡ç« æœåŠ¡

æœåŠ¡å±‚è¦è€ƒè™‘ï¼š
- ä¸šåŠ¡é€»è¾‘ï¼šçŠ¶æ€ç®¡ç†ã€æƒé™æ£€æŸ¥
- æ•°æ®å¤„ç†ï¼šæŸ¥è¯¢ä¼˜åŒ–ã€ç¼“å­˜ç­–ç•¥
- å¼‚å¸¸å¤„ç†ï¼šå‹å¥½çš„é”™è¯¯æç¤º

### 4. åˆ›å»ºæ–‡ç« æ§åˆ¶å™¨

æ§åˆ¶å™¨è¦è€ƒè™‘ï¼š
- è·¯ç”±è®¾è®¡ï¼šç¬¦åˆ RESTful è§„èŒƒ
- æƒé™æ§åˆ¶ï¼šç»†ç²’åº¦çš„æƒé™éªŒè¯
- æ–‡æ¡£å®Œå–„ï¼šSwagger æ³¨è§£

### 5. åˆ›å»ºæ–‡ç« æ¨¡å—

æ¨¡å—è¦è€ƒè™‘ï¼š
- ä¾èµ–ç®¡ç†ï¼šæ­£ç¡®çš„å¯¼å…¥å¯¼å‡º
- åŠŸèƒ½è¾¹ç•Œï¼šæ¨¡å—èŒè´£å•ä¸€
- æ‰©å±•æ€§ï¼šä¾¿äºåç»­åŠŸèƒ½æ‰©å±•

## âš¡ æœ€ä½³å®è·µä¸è§„èŒƒ

### 1. å‘½åè§„èŒƒ

- **æ–‡ä»¶å‘½å**ï¼šä½¿ç”¨ kebab-caseï¼Œå¦‚ `article-management.service.ts`
- **ç±»å‘½å**ï¼šä½¿ç”¨ PascalCaseï¼Œå¦‚ `ArticleManagementService`
- **æ–¹æ³•å‘½å**ï¼šä½¿ç”¨ camelCaseï¼Œå¦‚ `findArticleById`
- **å¸¸é‡å‘½å**ï¼šä½¿ç”¨ UPPER_SNAKE_CASEï¼Œå¦‚ `DEFAULT_PAGE_SIZE`

### 2. ä»£ç ç»„ç»‡

- **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªç±»å’Œæ–¹æ³•åªè´Ÿè´£ä¸€ä¸ªæ˜ç¡®çš„åŠŸèƒ½
- **ä¾èµ–æ³¨å…¥**ï¼šä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥ï¼Œé¿å…å¾ªç¯ä¾èµ–
- **æ¥å£åˆ†ç¦»**ï¼šå®šä¹‰æ¸…æ™°çš„æ¥å£ï¼Œå®ç°ä¸æ¥å£åˆ†ç¦»
- **é…ç½®å¤–ç½®**ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶ç®¡ç†å¯å˜å‚æ•°

### 3. é”™è¯¯å¤„ç†

```typescript
// ä½¿ç”¨ä¸šåŠ¡å¼‚å¸¸
throw new NotFoundException('æ–‡ç« ä¸å­˜åœ¨')

// ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸
throw new BusinessException(ErrorEnum.ARTICLE_NOT_FOUND)

// ä½¿ç”¨å¼‚å¸¸è¿‡æ»¤å™¨ç»Ÿä¸€å¤„ç†
@Catch(HttpException)
export class HttpExceptionFilter implements ExceptionFilter {
  catch(exception: HttpException, host: ArgumentsHost) {
    // ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼
  }
}
```

### 4. æ€§èƒ½ä¼˜åŒ–

- **æ•°æ®åº“æŸ¥è¯¢**ï¼šä½¿ç”¨ç´¢å¼•ï¼Œé¿å… N+1 æŸ¥è¯¢
- **ç¼“å­˜ç­–ç•¥**ï¼šåˆç†ä½¿ç”¨ Redis ç¼“å­˜çƒ­ç‚¹æ•°æ®
- **åˆ†é¡µå¤„ç†**ï¼šå¤§æ•°æ®é‡ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µ
- **å¼‚æ­¥å¤„ç†**ï¼šè€—æ—¶æ“ä½œä½¿ç”¨é˜Ÿåˆ—å¼‚æ­¥å¤„ç†

### 5. æµ‹è¯•ç¼–å†™

```typescript
describe('ArticleService', () => {
  let service: ArticleService
  let repository: Repository<ArticleEntity>

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [
        ArticleService,
        {
          provide: getRepositoryToken(ArticleEntity),
          useValue: mockRepository,
        },
      ],
    }).compile()

    service = module.get<ArticleService>(ArticleService)
    repository = module.get<Repository<ArticleEntity>>(getRepositoryToken(ArticleEntity))
  })

  it('should create an article', async () => {
    // æµ‹è¯•ç”¨ä¾‹
  })
})
```

é€šè¿‡éµå¾ªè¿™äº›æŒ‡å—å’Œæœ€ä½³å®è·µï¼Œä½ å¯ä»¥åœ¨ `nest-admin` é¡¹ç›®ä¸­é«˜æ•ˆåœ°å¼€å‘å‡ºé«˜è´¨é‡ã€å¯ç»´æŠ¤çš„åŠŸèƒ½æ¨¡å—ã€‚
