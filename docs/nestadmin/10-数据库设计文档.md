# æ•°æ®åº“è®¾è®¡æ–‡æ¡£

åŸºäº nest-admin é¡¹ç›®çš„æ•°æ®åº“è¡¨ç»“æ„ä¸è®¾è®¡æ€è·¯

## ğŸ“š ç›®å½•

- [æ•°æ®åº“è®¾è®¡æ–‡æ¡£](#æ•°æ®åº“è®¾è®¡æ–‡æ¡£)
  - [ğŸ“š ç›®å½•](#-ç›®å½•)
  - [ğŸ’¡ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ—ï¸ æ•°æ®åº“è®¾è®¡åŸåˆ™](#ï¸-æ•°æ®åº“è®¾è®¡åŸåˆ™)
    - [1. è®¾è®¡ç†å¿µ](#1-è®¾è®¡ç†å¿µ)
    - [2. å‘½åè§„èŒƒ](#2-å‘½åè§„èŒƒ)
    - [3. åŸºç¡€å®ä½“è®¾è®¡](#3-åŸºç¡€å®ä½“è®¾è®¡)
      - [CommonEntityï¼ˆåŸºç¡€å®ä½“ï¼‰](#commonentityåŸºç¡€å®ä½“)
      - [CompleteEntityï¼ˆå®Œæ•´å®ä½“ï¼‰](#completeentityå®Œæ•´å®ä½“)
  - [ğŸ“Š æ ¸å¿ƒè¡¨ç»“æ„è®¾è®¡](#-æ ¸å¿ƒè¡¨ç»“æ„è®¾è®¡)
    - [1. ç”¨æˆ·ç®¡ç†ç›¸å…³è¡¨](#1-ç”¨æˆ·ç®¡ç†ç›¸å…³è¡¨)
      - [sys\_userï¼ˆç”¨æˆ·è¡¨ï¼‰](#sys_userç”¨æˆ·è¡¨)
      - [user\_access\_tokensï¼ˆè®¿é—®ä»¤ç‰Œè¡¨ï¼‰](#user_access_tokensè®¿é—®ä»¤ç‰Œè¡¨)
      - [user\_refresh\_tokensï¼ˆåˆ·æ–°ä»¤ç‰Œè¡¨ï¼‰](#user_refresh_tokensåˆ·æ–°ä»¤ç‰Œè¡¨)
    - [2. æƒé™ç®¡ç†ç›¸å…³è¡¨](#2-æƒé™ç®¡ç†ç›¸å…³è¡¨)
      - [sys\_roleï¼ˆè§’è‰²è¡¨ï¼‰](#sys_roleè§’è‰²è¡¨)
      - [sys\_menuï¼ˆèœå•æƒé™è¡¨ï¼‰](#sys_menuèœå•æƒé™è¡¨)
      - [sys\_user\_rolesï¼ˆç”¨æˆ·è§’è‰²å…³è”è¡¨ï¼‰](#sys_user_rolesç”¨æˆ·è§’è‰²å…³è”è¡¨)
      - [sys\_role\_menusï¼ˆè§’è‰²èœå•å…³è”è¡¨ï¼‰](#sys_role_menusè§’è‰²èœå•å…³è”è¡¨)
    - [3. ç³»ç»Ÿç®¡ç†ç›¸å…³è¡¨](#3-ç³»ç»Ÿç®¡ç†ç›¸å…³è¡¨)
      - [sys\_deptï¼ˆéƒ¨é—¨è¡¨ï¼‰](#sys_deptéƒ¨é—¨è¡¨)
      - [sys\_configï¼ˆç³»ç»Ÿé…ç½®è¡¨ï¼‰](#sys_configç³»ç»Ÿé…ç½®è¡¨)
      - [sys\_dict\_typeï¼ˆå­—å…¸ç±»å‹è¡¨ï¼‰](#sys_dict_typeå­—å…¸ç±»å‹è¡¨)
      - [sys\_dict\_itemï¼ˆå­—å…¸é¡¹è¡¨ï¼‰](#sys_dict_itemå­—å…¸é¡¹è¡¨)
    - [4. æ—¥å¿—ç®¡ç†ç›¸å…³è¡¨](#4-æ—¥å¿—ç®¡ç†ç›¸å…³è¡¨)
      - [sys\_login\_logï¼ˆç™»å½•æ—¥å¿—è¡¨ï¼‰](#sys_login_logç™»å½•æ—¥å¿—è¡¨)
      - [sys\_task\_logï¼ˆä»»åŠ¡æ—¥å¿—è¡¨ï¼‰](#sys_task_logä»»åŠ¡æ—¥å¿—è¡¨)
      - [sys\_captcha\_logï¼ˆéªŒè¯ç æ—¥å¿—è¡¨ï¼‰](#sys_captcha_logéªŒè¯ç æ—¥å¿—è¡¨)
    - [5. ä¸šåŠ¡åŠŸèƒ½ç›¸å…³è¡¨](#5-ä¸šåŠ¡åŠŸèƒ½ç›¸å…³è¡¨)
      - [todoï¼ˆå¾…åŠäº‹é¡¹è¡¨ï¼‰](#todoå¾…åŠäº‹é¡¹è¡¨)
      - [tool\_storageï¼ˆæ–‡ä»¶å­˜å‚¨è¡¨ï¼‰](#tool_storageæ–‡ä»¶å­˜å‚¨è¡¨)
      - [sys\_taskï¼ˆç³»ç»Ÿä»»åŠ¡è¡¨ï¼‰](#sys_taskç³»ç»Ÿä»»åŠ¡è¡¨)
      - [wx\_userï¼ˆå¾®ä¿¡ç”¨æˆ·è¡¨ï¼‰](#wx_userå¾®ä¿¡ç”¨æˆ·è¡¨)
  - [ğŸ”— è¡¨å…³ç³»è®¾è®¡](#-è¡¨å…³ç³»è®¾è®¡)
    - [1. ç”¨æˆ·-è§’è‰²-æƒé™å…³ç³»](#1-ç”¨æˆ·-è§’è‰²-æƒé™å…³ç³»)
    - [2. ç»„ç»‡æ¶æ„å…³ç³»](#2-ç»„ç»‡æ¶æ„å…³ç³»)
    - [3. èœå•æƒé™å…³ç³»](#3-èœå•æƒé™å…³ç³»)
  - [ğŸ“ å­—æ®µè®¾è®¡è§„èŒƒ](#-å­—æ®µè®¾è®¡è§„èŒƒ)
    - [1. å…¬å…±å­—æ®µ](#1-å…¬å…±å­—æ®µ)
    - [2. çŠ¶æ€å­—æ®µ](#2-çŠ¶æ€å­—æ®µ)
    - [3. æ—¶é—´å­—æ®µ](#3-æ—¶é—´å­—æ®µ)
    - [4. å¤–é”®å­—æ®µ](#4-å¤–é”®å­—æ®µ)
  - [âš¡ æ€§èƒ½ä¼˜åŒ–è®¾è®¡](#-æ€§èƒ½ä¼˜åŒ–è®¾è®¡)
    - [1. ç´¢å¼•è®¾è®¡](#1-ç´¢å¼•è®¾è®¡)
      - [ä¸»é”®ç´¢å¼•](#ä¸»é”®ç´¢å¼•)
      - [å”¯ä¸€ç´¢å¼•](#å”¯ä¸€ç´¢å¼•)
      - [æ™®é€šç´¢å¼•](#æ™®é€šç´¢å¼•)
      - [å¤åˆç´¢å¼•](#å¤åˆç´¢å¼•)
    - [2. åˆ†é¡µä¼˜åŒ–](#2-åˆ†é¡µä¼˜åŒ–)
    - [3. æŸ¥è¯¢ä¼˜åŒ–](#3-æŸ¥è¯¢ä¼˜åŒ–)
      - [é¿å… N+1 æŸ¥è¯¢](#é¿å…-n1-æŸ¥è¯¢)
      - [ä½¿ç”¨è¦†ç›–ç´¢å¼•](#ä½¿ç”¨è¦†ç›–ç´¢å¼•)
  - [ğŸ”’ å®‰å…¨æ€§è®¾è®¡](#-å®‰å…¨æ€§è®¾è®¡)
    - [1. æ•°æ®å®‰å…¨](#1-æ•°æ®å®‰å…¨)
      - [å¯†ç åŠ å¯†å­˜å‚¨](#å¯†ç åŠ å¯†å­˜å‚¨)
      - [æ•æ„Ÿæ•°æ®å¤„ç†](#æ•æ„Ÿæ•°æ®å¤„ç†)
    - [2. è®¿é—®æ§åˆ¶](#2-è®¿é—®æ§åˆ¶)
      - [è½¯åˆ é™¤æœºåˆ¶](#è½¯åˆ é™¤æœºåˆ¶)
      - [æ•°æ®æƒé™æ§åˆ¶](#æ•°æ®æƒé™æ§åˆ¶)
    - [3. å®¡è®¡è¿½è¸ª](#3-å®¡è®¡è¿½è¸ª)
      - [æ“ä½œæ—¥å¿—è®°å½•](#æ“ä½œæ—¥å¿—è®°å½•)
  - [ğŸ“‹ æ•°æ®åº“è¿ç§»ç®¡ç†](#-æ•°æ®åº“è¿ç§»ç®¡ç†)
    - [1. è¿ç§»æ–‡ä»¶ç»“æ„](#1-è¿ç§»æ–‡ä»¶ç»“æ„)
    - [2. è¿ç§»æœ€ä½³å®è·µ](#2-è¿ç§»æœ€ä½³å®è·µ)
      - [åˆ›å»ºè¡¨è¿ç§»](#åˆ›å»ºè¡¨è¿ç§»)
      - [æ•°æ®åˆå§‹åŒ–è¿ç§»](#æ•°æ®åˆå§‹åŒ–è¿ç§»)
  - [âœ¨ æ‰©å±•è®¾è®¡æŒ‡å—](#-æ‰©å±•è®¾è®¡æŒ‡å—)
    - [1. æ–°è¡¨è®¾è®¡](#1-æ–°è¡¨è®¾è®¡)
    - [2. å­—æ®µæ‰©å±•](#2-å­—æ®µæ‰©å±•)
      - [æ·»åŠ æ–°å­—æ®µçš„è¿ç§»](#æ·»åŠ æ–°å­—æ®µçš„è¿ç§»)
    - [3. å…³ç³»ç»´æŠ¤](#3-å…³ç³»ç»´æŠ¤)
      - [å»ºç«‹å¤–é”®å…³ç³»](#å»ºç«‹å¤–é”®å…³ç³»)

## ğŸ’¡ æ¦‚è¿°

`nest-admin` é¡¹ç›®é‡‡ç”¨ MySQL ä½œä¸ºä¸»æ•°æ®åº“ï¼Œä½¿ç”¨ TypeORM ä½œä¸º ORM æ¡†æ¶ã€‚æ•°æ®åº“è®¾è®¡éµå¾ªäº†ç°ä»£ä¼ä¸šåº”ç”¨çš„æœ€ä½³å®è·µï¼ŒåŒ…æ‹¬ï¼šç”¨æˆ·è®¤è¯æˆæƒã€RBAC æƒé™æ¨¡å‹ã€ç»„ç»‡æ¶æ„ç®¡ç†ã€ç³»ç»Ÿé…ç½®ç®¡ç†ã€æ“ä½œæ—¥å¿—å®¡è®¡ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†é¡¹ç›®ä¸­æ‰€æœ‰è¡¨çš„ç»“æ„è®¾è®¡ã€å…³ç³»æ˜ å°„ã€ç´¢å¼•ç­–ç•¥ä»¥åŠæ‰©å±•æ–¹æ¡ˆï¼Œå¸®åŠ©å¼€å‘è€…æ·±å…¥ç†è§£æ•°æ®åº“æ¶æ„ï¼Œä¸ºäºŒæ¬¡å¼€å‘æä¾›æŒ‡å¯¼ã€‚

## ğŸ—ï¸ æ•°æ®åº“è®¾è®¡åŸåˆ™

### 1. è®¾è®¡ç†å¿µ

- **æ¨¡å—åŒ–è®¾è®¡**ï¼šæŒ‰ä¸šåŠ¡æ¨¡å—åˆ’åˆ†è¡¨ç»“æ„ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
- **è§„èŒƒåŒ–åŸåˆ™**ï¼šéµå¾ªæ•°æ®åº“èŒƒå¼ï¼Œå‡å°‘æ•°æ®å†—ä½™
- **æ‰©å±•æ€§ä¼˜å…ˆ**ï¼šé¢„ç•™æ‰©å±•å­—æ®µï¼Œæ”¯æŒä¸šåŠ¡å¿«é€Ÿè¿­ä»£
- **æ€§èƒ½å¯¼å‘**ï¼šåˆç†è®¾è®¡ç´¢å¼•ï¼Œä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
- **å®‰å…¨ç¬¬ä¸€**ï¼šæ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨ï¼Œå®Œå–„çš„å®¡è®¡æœºåˆ¶

### 2. å‘½åè§„èŒƒ

```sql
-- è¡¨åè§„èŒƒ
sys_user          -- ç³»ç»Ÿæ¨¡å—è¡¨ä»¥ sys_ å¼€å¤´
app_article       -- åº”ç”¨æ¨¡å—è¡¨ä»¥ app_ å¼€å¤´
tool_storage      -- å·¥å…·æ¨¡å—è¡¨ä»¥ tool_ å¼€å¤´
wx_user           -- å¾®ä¿¡æ¨¡å—è¡¨ä»¥ wx_ å¼€å¤´

-- å­—æ®µåè§„èŒƒ
user_id           -- å¤–é”®å­—æ®µä»¥ _id ç»“å°¾
created_at        -- æ—¶é—´å­—æ®µä½¿ç”¨ _at åç¼€
is_deleted        -- å¸ƒå°”å­—æ®µä½¿ç”¨ is_ å‰ç¼€
order_no          -- æ’åºå­—æ®µä½¿ç”¨ _no åç¼€
```

### 3. åŸºç¡€å®ä½“è®¾è®¡

é¡¹ç›®ä¸­æ‰€æœ‰è¡¨éƒ½ç»§æ‰¿è‡ªä¸¤ä¸ªåŸºç¡€å®ä½“ï¼š

#### CommonEntityï¼ˆåŸºç¡€å®ä½“ï¼‰
```sql
-- æ‰€æœ‰è¡¨çš„å…¬å…±å­—æ®µ
id            INT PRIMARY KEY AUTO_INCREMENT  -- ä¸»é”®ID
created_at    TIMESTAMP DEFAULT CURRENT_TIMESTAMP    -- åˆ›å»ºæ—¶é—´
updated_at    TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP -- æ›´æ–°æ—¶é—´
```

#### CompleteEntityï¼ˆå®Œæ•´å®ä½“ï¼‰
```sql
-- æ‰©å±•äº†æ“ä½œäººä¿¡æ¯çš„å®ä½“
id            INT PRIMARY KEY AUTO_INCREMENT
created_at    TIMESTAMP DEFAULT CURRENT_TIMESTAMP
updated_at    TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
create_by     INT COMMENT 'åˆ›å»ºè€…ID'           -- åˆ›å»ºäººID
update_by     INT COMMENT 'æ›´æ–°è€…ID'           -- æ›´æ–°äººID
```

## ğŸ“Š æ ¸å¿ƒè¡¨ç»“æ„è®¾è®¡

### 1. ç”¨æˆ·ç®¡ç†ç›¸å…³è¡¨

#### sys_userï¼ˆç”¨æˆ·è¡¨ï¼‰
```sql
CREATE TABLE `sys_user` (
  `id` int NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL COMMENT 'ç”¨æˆ·å',
  `password` varchar(255) NOT NULL DEFAULT 'WECHAT_USER_NO_PASSWORD' COMMENT 'å¯†ç ',
  `psalt` varchar(32) NOT NULL COMMENT 'å¯†ç ç›å€¼',
  `nickname` varchar(50) DEFAULT NULL COMMENT 'æ˜µç§°',
  `avatar` varchar(255) DEFAULT NULL COMMENT 'å¤´åƒ',
  `qq` varchar(20) DEFAULT NULL COMMENT 'QQå·',
  `email` varchar(100) DEFAULT NULL COMMENT 'é‚®ç®±',
  `phone` varchar(20) DEFAULT NULL COMMENT 'æ‰‹æœºå·',
  `remark` text COMMENT 'å¤‡æ³¨',
  `status` tinyint DEFAULT '1' COMMENT 'çŠ¶æ€ï¼š1å¯ç”¨ï¼Œ0ç¦ç”¨',
  `dept_id` int DEFAULT NULL COMMENT 'éƒ¨é—¨ID',
  `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `create_by` int DEFAULT NULL COMMENT 'åˆ›å»ºè€…',
  `update_by` int DEFAULT NULL COMMENT 'æ›´æ–°è€…',
  PRIMARY KEY (`id`),
  UNIQUE KEY `IDX_username` (`username`),
  KEY `IDX_email` (`email`),
  KEY `IDX_phone` (`phone`),
  KEY `IDX_dept_id` (`dept_id`),
  KEY `IDX_status` (`status`)
) COMMENT='ç³»ç»Ÿç”¨æˆ·è¡¨';
```

**è®¾è®¡è¦ç‚¹ï¼š**
- `username` è®¾ç½®å”¯ä¸€ç´¢å¼•ï¼Œç¡®ä¿ç”¨æˆ·åä¸é‡å¤
- `password` å­—æ®µå­˜å‚¨åŠ å¯†åçš„å¯†ç  + ç›å€¼
- `status` å­—æ®µæ”¯æŒç”¨æˆ·çŠ¶æ€ç®¡ç†ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰
- æ”¯æŒå¤šç§è”ç³»æ–¹å¼ï¼ˆQQã€é‚®ç®±ã€æ‰‹æœºï¼‰

#### user_access_tokensï¼ˆè®¿é—®ä»¤ç‰Œè¡¨ï¼‰
```sql
CREATE TABLE `user_access_tokens` (
  `id` int NOT NULL AUTO_INCREMENT,
  `value` varchar(500) NOT NULL COMMENT 'ä»¤ç‰Œå€¼',
  `expired_at` timestamp NOT NULL COMMENT 'è¿‡æœŸæ—¶é—´',
  `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
  `user_id` int NOT NULL COMMENT 'ç”¨æˆ·ID',
  PRIMARY KEY (`id`),
  UNIQUE KEY `IDX_value` (`value`),
  KEY `IDX_user_id` (`user_id`),
  KEY `IDX_expired_at` (`expired_at`)
) COMMENT='ç”¨æˆ·è®¿é—®ä»¤ç‰Œè¡¨';
```

#### user_refresh_tokensï¼ˆåˆ·æ–°ä»¤ç‰Œè¡¨ï¼‰
```sql
CREATE TABLE `user_refresh_tokens` (
  `id` int NOT NULL AUTO_INCREMENT,
  `value` varchar(500) NOT NULL COMMENT 'ä»¤ç‰Œå€¼',
  `expired_at` timestamp NOT NULL COMMENT 'è¿‡æœŸæ—¶é—´',
  `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
  `accesstoken_id` int NOT NULL COMMENT 'è®¿é—®ä»¤ç‰ŒID',
  PRIMARY KEY (`id`),
  UNIQUE KEY `IDX_value` (`value`),
  UNIQUE KEY `IDX_accesstoken_id` (`accesstoken_id`),
  KEY `IDX_expired_at` (`expired_at`)
) COMMENT='ç”¨æˆ·åˆ·æ–°ä»¤ç‰Œè¡¨';
```

### 2. æƒé™ç®¡ç†ç›¸å…³è¡¨

#### sys_roleï¼ˆè§’è‰²è¡¨ï¼‰
```sql
CREATE TABLE `sys_role` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL COMMENT 'è§’è‰²åç§°',
  `value` varchar(50) NOT NULL COMMENT 'è§’è‰²æ ‡è¯†',
  `remark` text COMMENT 'è§’è‰²æè¿°',
  `status` tinyint DEFAULT '1' COMMENT 'çŠ¶æ€ï¼š1å¯ç”¨ï¼Œ0ç¦ç”¨',
  `default` tinyint DEFAULT '0' COMMENT 'æ˜¯å¦é»˜è®¤è§’è‰²',
  `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `create_by` int DEFAULT NULL COMMENT 'åˆ›å»ºè€…',
  `update_by` int DEFAULT NULL COMMENT 'æ›´æ–°è€…',
  PRIMARY KEY (`id`),
  UNIQUE KEY `IDX_name` (`name`),
  UNIQUE KEY `IDX_value` (`value`),
  KEY `IDX_status` (`status`)
) COMMENT='ç³»ç»Ÿè§’è‰²è¡¨';
```

#### sys_menuï¼ˆèœå•æƒé™è¡¨ï¼‰
```sql
CREATE TABLE `sys_menu` (
  `id` int NOT NULL AUTO_INCREMENT,
  `parent_id` int DEFAULT NULL COMMENT 'çˆ¶çº§èœå•ID',
  `name` varchar(50) NOT NULL COMMENT 'èœå•åç§°',
  `path` varchar(255) DEFAULT NULL COMMENT 'è·¯ç”±è·¯å¾„',
  `permission` varchar(100) DEFAULT NULL COMMENT 'æƒé™æ ‡è¯†',
  `type` tinyint DEFAULT '0' COMMENT 'ç±»å‹ï¼š0ç›®å½•ï¼Œ1èœå•ï¼Œ2æŒ‰é’®',
  `icon` varchar(50) DEFAULT '' COMMENT 'å›¾æ ‡',
  `order_no` int DEFAULT '0' COMMENT 'æ’åºå·',
  `component` varchar(255) DEFAULT NULL COMMENT 'ç»„ä»¶è·¯å¾„',
  `is_ext` tinyint DEFAULT '0' COMMENT 'æ˜¯å¦å¤–é“¾',
  `ext_open_mode` tinyint DEFAULT '1' COMMENT 'å¤–é“¾æ‰“å¼€æ–¹å¼',
  `keep_alive` tinyint DEFAULT '1' COMMENT 'æ˜¯å¦ç¼“å­˜',
  `show` tinyint DEFAULT '1' COMMENT 'æ˜¯å¦æ˜¾ç¤º',
  `active_menu` varchar(255) DEFAULT NULL COMMENT 'æ¿€æ´»èœå•',
  `status` tinyint DEFAULT '1' COMMENT 'çŠ¶æ€ï¼š1å¯ç”¨ï¼Œ0ç¦ç”¨',
  `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `create_by` int DEFAULT NULL COMMENT 'åˆ›å»ºè€…',
  `update_by` int DEFAULT NULL COMMENT 'æ›´æ–°è€…',
  PRIMARY KEY (`id`),
  KEY `IDX_parent_id` (`parent_id`),
  KEY `IDX_permission` (`permission`),
  KEY `IDX_type` (`type`),
  KEY `IDX_status` (`status`)
) COMMENT='ç³»ç»Ÿèœå•è¡¨';
```

#### sys_user_rolesï¼ˆç”¨æˆ·è§’è‰²å…³è”è¡¨ï¼‰
```sql
CREATE TABLE `sys_user_roles` (
  `user_id` int NOT NULL COMMENT 'ç”¨æˆ·ID',
  `role_id` int NOT NULL COMMENT 'è§’è‰²ID',
  PRIMARY KEY (`user_id`, `role_id`),
  KEY `IDX_user_id` (`user_id`),
  KEY `IDX_role_id` (`role_id`)
) COMMENT='ç”¨æˆ·è§’è‰²å…³è”è¡¨';
```

#### sys_role_menusï¼ˆè§’è‰²èœå•å…³è”è¡¨ï¼‰
```sql
CREATE TABLE `sys_role_menus` (
  `role_id` int NOT NULL COMMENT 'è§’è‰²ID',
  `menu_id` int NOT NULL COMMENT 'èœå•ID',
  PRIMARY KEY (`role_id`, `menu_id`),
  KEY `IDX_role_id` (`role_id`),
  KEY `IDX_menu_id` (`menu_id`)
) COMMENT='è§’è‰²èœå•å…³è”è¡¨';
```

### 3. ç³»ç»Ÿç®¡ç†ç›¸å…³è¡¨

#### sys_deptï¼ˆéƒ¨é—¨è¡¨ï¼‰
```sql
CREATE TABLE `sys_dept` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL COMMENT 'éƒ¨é—¨åç§°',
  `order_no` int DEFAULT '0' COMMENT 'æ’åºå·',
  `mpath` varchar(255) DEFAULT '' COMMENT 'ç‰©åŒ–è·¯å¾„',
  `parent_id` int DEFAULT NULL COMMENT 'çˆ¶çº§éƒ¨é—¨ID',
  `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `create_by` int DEFAULT NULL COMMENT 'åˆ›å»ºè€…',
  `update_by` int DEFAULT NULL COMMENT 'æ›´æ–°è€…',
  PRIMARY KEY (`id`),
  KEY `IDX_parent_id` (`parent_id`),
  KEY `IDX_mpath` (`mpath`)
) COMMENT='ç³»ç»Ÿéƒ¨é—¨è¡¨';
```

**è®¾è®¡è¦ç‚¹ï¼š**
- ä½¿ç”¨ `mpath`ï¼ˆç‰©åŒ–è·¯å¾„ï¼‰å®ç°æ ‘å½¢ç»“æ„ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½
- æ”¯æŒæ— é™çº§éƒ¨é—¨å±‚æ¬¡ç»“æ„

#### sys_configï¼ˆç³»ç»Ÿé…ç½®è¡¨ï¼‰
```sql
CREATE TABLE `sys_config` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL COMMENT 'é…ç½®åç§°',
  `key` varchar(50) NOT NULL COMMENT 'é…ç½®é”®',
  `value` text COMMENT 'é…ç½®å€¼',
  `remark` varchar(255) DEFAULT NULL COMMENT 'å¤‡æ³¨',
  `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `create_by` int DEFAULT NULL COMMENT 'åˆ›å»ºè€…',
  `update_by` int DEFAULT NULL COMMENT 'æ›´æ–°è€…',
  PRIMARY KEY (`id`),
  UNIQUE KEY `IDX_key` (`key`)
) COMMENT='ç³»ç»Ÿé…ç½®è¡¨';
```

#### sys_dict_typeï¼ˆå­—å…¸ç±»å‹è¡¨ï¼‰
```sql
CREATE TABLE `sys_dict_type` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL COMMENT 'å­—å…¸åç§°',
  `code` varchar(50) NOT NULL COMMENT 'å­—å…¸ç¼–ç ',
  `status` tinyint DEFAULT '1' COMMENT 'çŠ¶æ€ï¼š1å¯ç”¨ï¼Œ0ç¦ç”¨',
  `remark` varchar(255) DEFAULT NULL COMMENT 'å¤‡æ³¨',
  `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `create_by` int DEFAULT NULL COMMENT 'åˆ›å»ºè€…',
  `update_by` int DEFAULT NULL COMMENT 'æ›´æ–°è€…',
  PRIMARY KEY (`id`),
  UNIQUE KEY `IDX_code` (`code`)
) COMMENT='å­—å…¸ç±»å‹è¡¨';
```

#### sys_dict_itemï¼ˆå­—å…¸é¡¹è¡¨ï¼‰
```sql
CREATE TABLE `sys_dict_item` (
  `id` int NOT NULL AUTO_INCREMENT,
  `label` varchar(50) NOT NULL COMMENT 'å­—å…¸æ ‡ç­¾',
  `value` varchar(50) NOT NULL COMMENT 'å­—å…¸å€¼',
  `order_no` int DEFAULT '0' COMMENT 'æ’åºå·',
  `status` tinyint DEFAULT '1' COMMENT 'çŠ¶æ€ï¼š1å¯ç”¨ï¼Œ0ç¦ç”¨',
  `remark` varchar(255) DEFAULT NULL COMMENT 'å¤‡æ³¨',
  `type_id` int NOT NULL COMMENT 'å­—å…¸ç±»å‹ID',
  `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `create_by` int DEFAULT NULL COMMENT 'åˆ›å»ºè€…',
  `update_by` int DEFAULT NULL COMMENT 'æ›´æ–°è€…',
  PRIMARY KEY (`id`),
  KEY `IDX_type_id` (`type_id`),
  KEY `IDX_value` (`value`)
) COMMENT='å­—å…¸é¡¹è¡¨';
```

### 4. æ—¥å¿—ç®¡ç†ç›¸å…³è¡¨

#### sys_login_logï¼ˆç™»å½•æ—¥å¿—è¡¨ï¼‰
```sql
CREATE TABLE `sys_login_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `ip` varchar(50) DEFAULT NULL COMMENT 'ç™»å½•IP',
  `address` varchar(255) DEFAULT NULL COMMENT 'ç™»å½•åœ°å€',
  `provider` varchar(50) DEFAULT NULL COMMENT 'ç™»å½•æ–¹å¼',
  `ua` varchar(500) DEFAULT NULL COMMENT 'æµè§ˆå™¨UA',
  `user_id` int DEFAULT NULL COMMENT 'ç”¨æˆ·ID',
  `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `IDX_user_id` (`user_id`),
  KEY `IDX_ip` (`ip`),
  KEY `IDX_created_at` (`created_at`)
) COMMENT='ç™»å½•æ—¥å¿—è¡¨';
```

#### sys_task_logï¼ˆä»»åŠ¡æ—¥å¿—è¡¨ï¼‰
```sql
CREATE TABLE `sys_task_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `task_id` int DEFAULT NULL COMMENT 'ä»»åŠ¡ID',
  `status` tinyint DEFAULT '0' COMMENT 'æ‰§è¡ŒçŠ¶æ€ï¼š0å¤±è´¥ï¼Œ1æˆåŠŸ',
  `detail` text COMMENT 'æ‰§è¡Œè¯¦æƒ…',
  `consume_time` int DEFAULT '0' COMMENT 'æ¶ˆè€—æ—¶é—´(ms)',
  `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `IDX_task_id` (`task_id`),
  KEY `IDX_status` (`status`),
  KEY `IDX_created_at` (`created_at`)
) COMMENT='ä»»åŠ¡æ‰§è¡Œæ—¥å¿—è¡¨';
```

#### sys_captcha_logï¼ˆéªŒè¯ç æ—¥å¿—è¡¨ï¼‰
```sql
CREATE TABLE `sys_captcha_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int DEFAULT NULL COMMENT 'ç”¨æˆ·ID',
  `type` varchar(20) NOT NULL COMMENT 'éªŒè¯ç ç±»å‹',
  `code` varchar(10) NOT NULL COMMENT 'éªŒè¯ç ',
  `status` tinyint DEFAULT '0' COMMENT 'çŠ¶æ€ï¼š0æœªä½¿ç”¨ï¼Œ1å·²ä½¿ç”¨',
  `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `IDX_user_id` (`user_id`),
  KEY `IDX_type` (`type`),
  KEY `IDX_created_at` (`created_at`)
) COMMENT='éªŒè¯ç æ—¥å¿—è¡¨';
```

### 5. ä¸šåŠ¡åŠŸèƒ½ç›¸å…³è¡¨

#### todoï¼ˆå¾…åŠäº‹é¡¹è¡¨ï¼‰
```sql
CREATE TABLE `todo` (
  `id` int NOT NULL AUTO_INCREMENT,
  `value` varchar(255) NOT NULL COMMENT 'å¾…åŠå†…å®¹',
  `user_id` int NOT NULL COMMENT 'ç”¨æˆ·ID',
  `status` tinyint DEFAULT '0' COMMENT 'çŠ¶æ€ï¼š0æœªå®Œæˆï¼Œ1å·²å®Œæˆ',
  `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `IDX_user_id` (`user_id`),
  KEY `IDX_status` (`status`)
) COMMENT='å¾…åŠäº‹é¡¹è¡¨';
```

#### tool_storageï¼ˆæ–‡ä»¶å­˜å‚¨è¡¨ï¼‰
```sql
CREATE TABLE `tool_storage` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(200) NOT NULL COMMENT 'å­˜å‚¨æ–‡ä»¶å',
  `file_name` varchar(200) DEFAULT NULL COMMENT 'çœŸå®æ–‡ä»¶å',
  `ext_name` varchar(20) DEFAULT NULL COMMENT 'æ–‡ä»¶æ‰©å±•å',
  `path` varchar(500) NOT NULL COMMENT 'æ–‡ä»¶è·¯å¾„',
  `type` varchar(50) DEFAULT NULL COMMENT 'æ–‡ä»¶ç±»å‹',
  `size` varchar(50) DEFAULT NULL COMMENT 'æ–‡ä»¶å¤§å°',
  `user_id` int DEFAULT NULL COMMENT 'ä¸Šä¼ ç”¨æˆ·ID',
  `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `IDX_user_id` (`user_id`),
  KEY `IDX_type` (`type`),
  KEY `IDX_created_at` (`created_at`)
) COMMENT='æ–‡ä»¶å­˜å‚¨è¡¨';
```

#### sys_taskï¼ˆç³»ç»Ÿä»»åŠ¡è¡¨ï¼‰
```sql
CREATE TABLE `sys_task` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL COMMENT 'ä»»åŠ¡åç§°',
  `service` varchar(100) NOT NULL COMMENT 'æœåŠ¡å',
  `type` tinyint DEFAULT '0' COMMENT 'ç±»å‹ï¼š0cronï¼Œ1é—´éš”',
  `status` tinyint DEFAULT '1' COMMENT 'çŠ¶æ€ï¼š1å¯ç”¨ï¼Œ0ç¦ç”¨',
  `start_time` timestamp NULL DEFAULT NULL COMMENT 'å¼€å§‹æ—¶é—´',
  `end_time` timestamp NULL DEFAULT NULL COMMENT 'ç»“æŸæ—¶é—´',
  `limit` int DEFAULT '0' COMMENT 'æ‰§è¡Œæ¬¡æ•°é™åˆ¶',
  `cron` varchar(50) DEFAULT NULL COMMENT 'cronè¡¨è¾¾å¼',
  `every` int DEFAULT NULL COMMENT 'é—´éš”æ—¶é—´(ç§’)',
  `data` text COMMENT 'ä»»åŠ¡æ•°æ®',
  `job_opts` text COMMENT 'ä»»åŠ¡é€‰é¡¹',
  `remark` varchar(255) DEFAULT NULL COMMENT 'å¤‡æ³¨',
  `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `create_by` int DEFAULT NULL COMMENT 'åˆ›å»ºè€…',
  `update_by` int DEFAULT NULL COMMENT 'æ›´æ–°è€…',
  PRIMARY KEY (`id`),
  KEY `IDX_status` (`status`),
  KEY `IDX_type` (`type`)
) COMMENT='ç³»ç»Ÿä»»åŠ¡è¡¨';
```

#### wx_userï¼ˆå¾®ä¿¡ç”¨æˆ·è¡¨ï¼‰
```sql
CREATE TABLE `wx_user` (
  `id` int NOT NULL AUTO_INCREMENT,
  `open_id` varchar(50) NOT NULL COMMENT 'å¾®ä¿¡OpenID',
  `union_id` varchar(50) DEFAULT NULL COMMENT 'å¾®ä¿¡UnionID',
  `nickname` varchar(50) DEFAULT NULL COMMENT 'å¾®ä¿¡æ˜µç§°',
  `avatar_url` varchar(500) DEFAULT NULL COMMENT 'å¤´åƒURL',
  `gender` tinyint DEFAULT NULL COMMENT 'æ€§åˆ«',
  `language` varchar(20) DEFAULT NULL COMMENT 'è¯­è¨€',
  `city` varchar(50) DEFAULT NULL COMMENT 'åŸå¸‚',
  `province` varchar(50) DEFAULT NULL COMMENT 'çœä»½',
  `country` varchar(50) DEFAULT NULL COMMENT 'å›½å®¶',
  `user_id` int DEFAULT NULL COMMENT 'å…³è”ç”¨æˆ·ID',
  `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `IDX_open_id` (`open_id`),
  KEY `IDX_union_id` (`union_id`),
  KEY `IDX_user_id` (`user_id`)
) COMMENT='å¾®ä¿¡ç”¨æˆ·è¡¨';
```

## ğŸ”— è¡¨å…³ç³»è®¾è®¡

### 1. ç”¨æˆ·-è§’è‰²-æƒé™å…³ç³»

```
sys_user (ç”¨æˆ·è¡¨)
    â†“ å¤šå¯¹å¤š
sys_user_roles (ç”¨æˆ·è§’è‰²å…³è”è¡¨)
    â†“ å¤šå¯¹å¤š
sys_role (è§’è‰²è¡¨)
    â†“ å¤šå¯¹å¤š
sys_role_menus (è§’è‰²èœå•å…³è”è¡¨)
    â†“ å¤šå¯¹å¤š
sys_menu (èœå•æƒé™è¡¨)
```

**å…³ç³»è¯´æ˜ï¼š**
- ä¸€ä¸ªç”¨æˆ·å¯ä»¥æ‹¥æœ‰å¤šä¸ªè§’è‰²
- ä¸€ä¸ªè§’è‰²å¯ä»¥åˆ†é…ç»™å¤šä¸ªç”¨æˆ·
- ä¸€ä¸ªè§’è‰²å¯ä»¥æ‹¥æœ‰å¤šä¸ªèœå•æƒé™
- ä¸€ä¸ªèœå•æƒé™å¯ä»¥åˆ†é…ç»™å¤šä¸ªè§’è‰²

### 2. ç»„ç»‡æ¶æ„å…³ç³»

```
sys_dept (éƒ¨é—¨è¡¨) - æ ‘å½¢ç»“æ„
    â†“ ä¸€å¯¹å¤š
sys_user (ç”¨æˆ·è¡¨)
```

**å…³ç³»è¯´æ˜ï¼š**
- éƒ¨é—¨è¡¨ä½¿ç”¨ç‰©åŒ–è·¯å¾„å®ç°æ ‘å½¢ç»“æ„
- ä¸€ä¸ªéƒ¨é—¨å¯ä»¥æœ‰å¤šä¸ªç”¨æˆ·
- ä¸€ä¸ªç”¨æˆ·åªèƒ½å±äºä¸€ä¸ªéƒ¨é—¨

### 3. èœå•æƒé™å…³ç³»

```
sys_menu (èœå•è¡¨) - æ ‘å½¢ç»“æ„
    â†“ é€šè¿‡ parent_id å®ç°çˆ¶å­å…³ç³»
```

**å…³ç³»è¯´æ˜ï¼š**
- èœå•è¡¨æ”¯æŒæ— é™çº§å±‚æ¬¡ç»“æ„
- é€šè¿‡ `type` å­—æ®µåŒºåˆ†ç›®å½•ã€èœå•ã€æŒ‰é’®
- é€šè¿‡ `permission` å­—æ®µå®ç°ç»†ç²’åº¦æƒé™æ§åˆ¶

## ğŸ“ å­—æ®µè®¾è®¡è§„èŒƒ

### 1. å…¬å…±å­—æ®µ

æ‰€æœ‰è¡¨éƒ½åŒ…å«çš„åŸºç¡€å­—æ®µï¼š
```sql
id            INT PRIMARY KEY AUTO_INCREMENT  -- ä¸»é”®
created_at    TIMESTAMP DEFAULT CURRENT_TIMESTAMP    -- åˆ›å»ºæ—¶é—´
updated_at    TIMESTAMP ON UPDATE CURRENT_TIMESTAMP  -- æ›´æ–°æ—¶é—´
```

ç®¡ç†è¡¨è¿˜åŒ…å«æ“ä½œäººå­—æ®µï¼š
```sql
create_by     INT COMMENT 'åˆ›å»ºè€…ID'
update_by     INT COMMENT 'æ›´æ–°è€…ID'
```

### 2. çŠ¶æ€å­—æ®µ

ç»Ÿä¸€ä½¿ç”¨ `tinyint` ç±»å‹ï¼š
```sql
status        TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š1å¯ç”¨ï¼Œ0ç¦ç”¨'
```

### 3. æ—¶é—´å­—æ®µ

- åˆ›å»ºæ—¶é—´ï¼š`created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP`
- æ›´æ–°æ—¶é—´ï¼š`updated_at TIMESTAMP ON UPDATE CURRENT_TIMESTAMP`
- ä¸šåŠ¡æ—¶é—´ï¼š`publish_time TIMESTAMP NULL COMMENT 'å‘å¸ƒæ—¶é—´'`

### 4. å¤–é”®å­—æ®µ

å¤–é”®å­—æ®µç»Ÿä¸€ä»¥ `_id` ç»“å°¾ï¼š
```sql
user_id       INT COMMENT 'ç”¨æˆ·ID'
dept_id       INT COMMENT 'éƒ¨é—¨ID'
parent_id     INT COMMENT 'çˆ¶çº§ID'
```

## âš¡ æ€§èƒ½ä¼˜åŒ–è®¾è®¡

### 1. ç´¢å¼•è®¾è®¡

#### ä¸»é”®ç´¢å¼•
```sql
PRIMARY KEY (`id`)
```

#### å”¯ä¸€ç´¢å¼•
```sql
UNIQUE KEY `IDX_username` (`username`)
UNIQUE KEY `IDX_email` (`email`)
```

#### æ™®é€šç´¢å¼•
```sql
KEY `IDX_status` (`status`)
KEY `IDX_created_at` (`created_at`)
KEY `IDX_user_id` (`user_id`)
```

#### å¤åˆç´¢å¼•
```sql
KEY `IDX_user_status` (`user_id`, `status`)
KEY `IDX_type_status` (`type`, `status`)
```

### 2. åˆ†é¡µä¼˜åŒ–

ä½¿ç”¨ `LIMIT` + `OFFSET` è¿›è¡Œåˆ†é¡µï¼š
```sql
SELECT * FROM sys_user
WHERE status = 1
ORDER BY id DESC
LIMIT 20 OFFSET 0;
```

å¤§æ•°æ®é‡æ—¶ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µï¼š
```sql
SELECT * FROM sys_user
WHERE id < 10000 AND status = 1
ORDER BY id DESC
LIMIT 20;
```

### 3. æŸ¥è¯¢ä¼˜åŒ–

#### é¿å… N+1 æŸ¥è¯¢
```typescript
// ä½¿ç”¨ leftJoinAndSelect ä¸€æ¬¡æ€§åŠ è½½å…³è”æ•°æ®
const users = await this.userRepository
  .createQueryBuilder('user')
  .leftJoinAndSelect('user.roles', 'role')
  .leftJoinAndSelect('user.dept', 'dept')
  .getMany()
```

#### ä½¿ç”¨è¦†ç›–ç´¢å¼•
```sql
-- ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µå»ºç«‹å¤åˆç´¢å¼•
KEY `IDX_user_list` (`status`, `dept_id`, `created_at`)
```

## ğŸ”’ å®‰å…¨æ€§è®¾è®¡

### 1. æ•°æ®å®‰å…¨

#### å¯†ç åŠ å¯†å­˜å‚¨
```sql
-- ç”¨æˆ·è¡¨ä¸­å¯†ç å­—æ®µè®¾è®¡
password      VARCHAR(255) NOT NULL COMMENT 'åŠ å¯†åçš„å¯†ç '
psalt         VARCHAR(32) NOT NULL COMMENT 'å¯†ç ç›å€¼'
```

#### æ•æ„Ÿæ•°æ®å¤„ç†
```typescript
// ä½¿ç”¨ @Exclude() è£…é¥°å™¨éšè—æ•æ„Ÿå­—æ®µ
@Exclude()
@Column()
password: string
```

### 2. è®¿é—®æ§åˆ¶

#### è½¯åˆ é™¤æœºåˆ¶
```sql
-- å¯é€‰æ‹©æ·»åŠ è½¯åˆ é™¤å­—æ®µ
is_deleted    TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦åˆ é™¤ï¼š1å·²åˆ é™¤ï¼Œ0æœªåˆ é™¤'
deleted_at    TIMESTAMP NULL COMMENT 'åˆ é™¤æ—¶é—´'
```

#### æ•°æ®æƒé™æ§åˆ¶
```sql
-- åœ¨æŸ¥è¯¢ä¸­æ·»åŠ æ•°æ®æƒé™è¿‡æ»¤
SELECT * FROM sys_user
WHERE dept_id IN (SELECT id FROM sys_dept WHERE mpath LIKE '1.2.%')
```

### 3. å®¡è®¡è¿½è¸ª

#### æ“ä½œæ—¥å¿—è®°å½•
```sql
-- è®°å½•å…³é”®æ“ä½œçš„è¯¦ç»†ä¿¡æ¯
CREATE TABLE `sys_audit_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int DEFAULT NULL COMMENT 'æ“ä½œç”¨æˆ·ID',
  `action` varchar(50) NOT NULL COMMENT 'æ“ä½œç±»å‹',
  `resource` varchar(100) NOT NULL COMMENT 'æ“ä½œèµ„æº',
  `resource_id` varchar(50) DEFAULT NULL COMMENT 'èµ„æºID',
  `ip` varchar(50) DEFAULT NULL COMMENT 'æ“ä½œIP',
  `user_agent` varchar(500) DEFAULT NULL COMMENT 'ç”¨æˆ·ä»£ç†',
  `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `IDX_user_id` (`user_id`),
  KEY `IDX_action` (`action`),
  KEY `IDX_created_at` (`created_at`)
) COMMENT='å®¡è®¡æ—¥å¿—è¡¨';
```

## ğŸ“‹ æ•°æ®åº“è¿ç§»ç®¡ç†

### 1. è¿ç§»æ–‡ä»¶ç»“æ„

```
src/migrations/
â”œâ”€â”€ 1609459200000-CreateUserTable.ts      -- åˆ›å»ºç”¨æˆ·è¡¨
â”œâ”€â”€ 1609459300000-CreateRoleTable.ts      -- åˆ›å»ºè§’è‰²è¡¨
â”œâ”€â”€ 1609459400000-CreateMenuTable.ts      -- åˆ›å»ºèœå•è¡¨
â”œâ”€â”€ 1609459500000-AddUserRoleRelation.ts  -- æ·»åŠ ç”¨æˆ·è§’è‰²å…³ç³»
â””â”€â”€ 1609459600000-InitSystemData.ts       -- åˆå§‹åŒ–ç³»ç»Ÿæ•°æ®
```

### 2. è¿ç§»æœ€ä½³å®è·µ

#### åˆ›å»ºè¡¨è¿ç§»
```typescript
import { MigrationInterface, QueryRunner, Table } from 'typeorm'

export class CreateUserTable1609459200000 implements MigrationInterface {
  public async up(queryRunner: QueryRunner): Promise<void> {
    await queryRunner.createTable(
      new Table({
        name: 'sys_user',
        columns: [
          {
            name: 'id',
            type: 'int',
            isPrimary: true,
            isGenerated: true,
            generationStrategy: 'increment',
          },
          {
            name: 'username',
            type: 'varchar',
            length: '50',
            isUnique: true,
          },
          // ... å…¶ä»–å­—æ®µ
        ],
        indices: [
          {
            name: 'IDX_username',
            columnNames: ['username'],
            isUnique: true,
          },
        ],
      }),
      true,
    )
  }

  public async down(queryRunner: QueryRunner): Promise<void> {
    await queryRunner.dropTable('sys_user')
  }
}
```

#### æ•°æ®åˆå§‹åŒ–è¿ç§»
```typescript
export class InitSystemData1609459600000 implements MigrationInterface {
  public async up(queryRunner: QueryRunner): Promise<void> {
    // åˆå§‹åŒ–è¶…çº§ç®¡ç†å‘˜
    await queryRunner.query(`
      INSERT INTO sys_user (username, password, psalt, nickname, status)
      VALUES ('admin', 'encrypted_password', 'salt_value', 'è¶…çº§ç®¡ç†å‘˜', 1)
    `)

    // åˆå§‹åŒ–é»˜è®¤è§’è‰²
    await queryRunner.query(`
      INSERT INTO sys_role (name, value, remark, status)
      VALUES ('è¶…çº§ç®¡ç†å‘˜', 'admin', 'ç³»ç»Ÿè¶…çº§ç®¡ç†å‘˜', 1)
    `)
  }

  public async down(queryRunner: QueryRunner): Promise<void> {
    await queryRunner.query(`DELETE FROM sys_user WHERE username = 'admin'`)
    await queryRunner.query(`DELETE FROM sys_role WHERE value = 'admin'`)
  }
}
```

## âœ¨ æ‰©å±•è®¾è®¡æŒ‡å—

### 1. æ–°è¡¨è®¾è®¡

åˆ›å»ºæ–°ä¸šåŠ¡è¡¨æ—¶åº”éµå¾ªä»¥ä¸‹è§„èŒƒï¼š

```typescript
// 1. ç»§æ‰¿åŸºç¡€å®ä½“
@Entity({ name: 'app_article' })
export class ArticleEntity extends CompleteEntity {
  // 2. æ·»åŠ ä¸šåŠ¡å­—æ®µ
  @Column({ length: 100 })
  title: string

  @Column({ type: 'text' })
  content: string

  // 3. æ·»åŠ å…³è”å…³ç³»
  @ManyToOne(() => UserEntity)
  @JoinColumn({ name: 'author_id' })
  author: Relation<UserEntity>

  // 4. æ·»åŠ ç´¢å¼•ï¼ˆé€šè¿‡è£…é¥°å™¨æˆ–è¿ç§»ï¼‰
  @Index('IDX_title')
  @Column()
  title: string
}
```

### 2. å­—æ®µæ‰©å±•

#### æ·»åŠ æ–°å­—æ®µçš„è¿ç§»
```typescript
export class AddArticleCategory1609459700000 implements MigrationInterface {
  public async up(queryRunner: QueryRunner): Promise<void> {
    await queryRunner.addColumn(
      'app_article',
      new TableColumn({
        name: 'category_id',
        type: 'int',
        isNullable: true,
        comment: 'åˆ†ç±»ID',
      }),
    )

    await queryRunner.createIndex(
      'app_article',
      new TableIndex({
        name: 'IDX_category_id',
        columnNames: ['category_id'],
      }),
    )
  }

  public async down(queryRunner: QueryRunner): Promise<void> {
    await queryRunner.dropIndex('app_article', 'IDX_category_id')
    await queryRunner.dropColumn('app_article', 'category_id')
  }
}
```

### 3. å…³ç³»ç»´æŠ¤

#### å»ºç«‹å¤–é”®å…³ç³»
```typescript
export class AddForeignKeys1609459800000 implements MigrationInterface {
  public async up(queryRunner: QueryRunner): Promise<void> {
    await queryRunner.createForeignKey(
      'sys_user',
      new TableForeignKey({
        columnNames: ['dept_id'],
        referencedTableName: 'sys_dept',
        referencedColumnNames: ['id'],
        onDelete: 'SET NULL',
      }),
    )
  }

  public async down(queryRunner: QueryRunner): Promise<void> {
    const table = await queryRunner.getTable('sys_user')
    const foreignKey = table.foreignKeys.find(
      fk => fk.columnNames.includes('dept_id'),
    )
    await queryRunner.dropForeignKey('sys_user', foreignKey)
  }
}
```

é€šè¿‡éµå¾ªè¿™äº›æ•°æ®åº“è®¾è®¡åŸåˆ™å’Œè§„èŒƒï¼Œä½ å¯ä»¥æ„å»ºå‡ºé«˜æ€§èƒ½ã€æ˜“æ‰©å±•ã€å®‰å…¨å¯é çš„æ•°æ®åº“æ¶æ„ï¼Œä¸º `nest-admin` é¡¹ç›®çš„é•¿æœŸå‘å±•æä¾›åšå®çš„æ•°æ®æ”¯æ’‘ã€‚
